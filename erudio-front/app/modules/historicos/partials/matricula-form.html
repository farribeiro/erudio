<!--* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *    @author Municipio de Itajaí - Secretaria de Educação - DITEC         *
 *    @updated 30/06/2016                                                  *
 *    Pacote: Erudio                                                       *
 *                                                                         *
 *    Copyright (C) 2016 Prefeitura de Itajaí - Secretaria de Educação     *
 *                       DITEC - Diretoria de Tecnologias educacionais     *
 *                        ditec@itajai.sc.gov.br                           *
 *                                                                         *
 *    Este  programa  é  software livre, você pode redistribuí-lo e/ou     *
 *    modificá-lo sob os termos da Licença Pública Geral GNU, conforme     *
 *    publicada pela Free  Software  Foundation,  tanto  a versão 2 da     *
 *    Licença   como  (a  seu  critério)  qualquer  versão  mais  nova.    *
 *                                                                         *
 *    Este programa  é distribuído na expectativa de ser útil, mas SEM     *
 *    QUALQUER GARANTIA. Sem mesmo a garantia implícita de COMERCIALI-     *
 *    ZAÇÃO  ou  de ADEQUAÇÃO A QUALQUER PROPÓSITO EM PARTICULAR. Con-     *
 *    sulte  a  Licença  Pública  Geral  GNU para obter mais detalhes.     *
 *                                                                         *
 *    Você  deve  ter  recebido uma cópia da Licença Pública Geral GNU     *
 *    junto  com  este  programa. Se não, escreva para a Free Software     *
 *    Foundation,  Inc.,  59  Temple  Place,  Suite  330,  Boston,  MA     *
 *    02111-1307, USA.                                                     *
 *                                                                         *
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->

<div id="frequencias">
    <div class="row">
        <div class="col s12 historicos-banner">
        </div>
    </div>
    <div class="row s12 m12">
        <div class="col s12 l12 mobile-full">
            <div class="row" style="margin-top: -64px;" >
                
                <div class="card" ng-show="isAdicionandoDisciplina" style="overflow-y: auto; min-height: 700px;">
                    <div class="card-content white-text" style='color: #000 !important;'>
                        <div class="row" ng-show="isDisciplinaForm">                            
                            <span id="formEnter" ng-show="isDisciplinaForm" class="card-title" style='color: #000;'>{{ acaoDisciplina }} Disciplina</span>
                            <div ng-show="isDisciplinaForm" class="row">
                                <div class="col s12" style="padding: 10px; text-align: center;">Se a disciplina desejada não estiver na lista, entre em contato com o Administrador do Sistema para incluí-la.</div>
                            </div>
                            <div class="col s12 m12 l12 input-field" ng-show="disciCursada.id === undefined">
                                <i class="material-icons prefix">location_on</i>
                                <select id="discEtapa" ng-change="escolherDisciplinas()" data-ng-model="etapaNovaDisc" data-ng-disabled="!escrita" required>
                                    <option></option>
                                    <option value="{{ etapa.id }}" data-ng-repeat="etapa in etapas">{{ etapa.nomeExibicao }}</option>
                                </select>
                                <label for="discEtapa" class="ajuste-select-top-label">Etapa*</label>
                            </div>
                            <div class="col s12 m12 l12 input-field" ng-show="disciCursada.id === undefined">
                                <i class="material-icons prefix">location_on</i>
                                <select id="discConclusao" data-ng-change="verificarDisciplina()" data-ng-model="disciplinaConclusaoId" data-ng-disabled="!escrita" required>
                                    <option></option>
                                    <option value="{{ disciplina.id }}" ng-if="disciplina.ofertado" data-ng-selected="verificaDisciplinaConclusao(disciplina.id)" data-ng-repeat="disciplina in todasDisciplinas track by $index">{{ disciplina.nomeExibicao }}</option>
                                    <option data-ng-selected="verificaDisciplinaConclusao('outro')" value="outro">Outro</option>
                                </select>
                                <label for="discConclusao" class="ajuste-select-top-label">Disciplina*</label>
                            </div>
                            <div class="input-field col s12 m12 l12" data-ng-show="autocompleteDisciplina">
                                <i class="material-icons prefix">location_on</i>
                                <span class="digitable-icon"><i class="material-icons">border_color</i></span>
                                <input id="naoOfertadas" class="dropdown" type="text" ng-change="filtroDisciplina()" data-ng-model="disciplinaNome" data-ng-disabled="!escrita" data-activates='dropNaoOfertadas'>
                                <label for="naoOfertadas">Digite uma disciplina</label>
                            </div>
                            <ul id='dropNaoOfertadas' class='dropdown-content'>
                                <li class="divider"></li>
                                <li data-ng-repeat="disciplina in todasDisciplinasDisponiveis track by $index">
                                    <a ng-if="!discplina.ofertado" data-ng-click="carregarDisciplina(disciplina)">{{ disciplina.nomeExibicao }} - {{ disciplina.etapa.nomeExibicao }}</a>
                                </li>
                            </ul>
                            <div class="col s12 m12 l6 input-field">
                                <i class="material-icons prefix">filter_8</i>
                                <input id="mFinal" type="text" class="validate" data-ng-model="mediaFinalConclusao" data-ng-disabled="!escrita" required />
                                <label for="mFinal">Média Final*</label>
                            </div>
                            <div class="col s12 m12 l6 input-field">
                                <i class="material-icons prefix">filter_7</i>
                                <input id="freq" type="text" class="validate" data-ng-model="freqConclusao" data-ng-disabled="!escrita" required />
                                <label for="freq">Frequência Total(%)*</label>
                            </div>
                            <div class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">location_on</i>
                                <select id="statusConclusao" data-ng-model="statusConclusao" data-ng-disabled="!escrita" required>
                                    <option value="APROVADO" data-ng-selected="verificaSelectStatus('APROVADO')">APROVADO</option>
                                    <option value="DISPENSADO" data-ng-selected="verificaSelectStatus('DISPENSADO')">DISPENSADO</option>
                                </select>
                                <label for="statusConclusao">Status*</label>
                            </div>
                            <div class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">filter_7</i>
                                <input id="anoDisc" type="text" class="validate" data-ng-model="anoDisc" data-ng-disabled="!escrita" required />
                                <label for="anoDisc">Ano Encerramento*</label>
                            </div>
                        </div>
                        <span ng-show="mostraDadosConclusao" class="card-title" style='color: #000;'>Adicionar Dados de Conclusão</span>
                        <div ng-show="mostraDadosConclusao" class="row">
                            <div class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">location_on</i>
                                <select id="concEtapa" ng-change="filtrarEtapasCursadas()" data-ng-model="etapaNovaConc" data-ng-disabled="!escrita || bloquearEtapaCursada" required>
                                    <option></option>
                                    <option value="{{ etapa.id }}" data-ng-repeat="etapa in etapas">{{ etapa.nomeExibicao }}</option>
                                </select>
                                <label for="discEtapa" class="ajuste-select-top-label">Etapa*</label>
                            </div>
                            <div ng-show="abreFormConclusao" class="col s12 m12 l6 input-field">
                                <i class="material-icons prefix">account_box</i>
                                <input id="unidade" type="text" focus-on="focusMe" class="validate" data-ng-model="unidadeConclusao" data-ng-disabled="!escrita || etapaCursada.auto === true" required />
                                <label for="unidade">Unidade de Ensino*</label>
                            </div>
                            <div ng-show="abreFormConclusao" class="col s12 m12 l6 input-field">
                                <i class="material-icons prefix">number</i>
                                <input id="ano" type="text" class="validate" data-ng-model="anoConclusao" data-ng-disabled="!escrita" required />
                                <label for="ano">Ano*</label>
                            </div>
                            <div ng-show="abreFormConclusao" class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">location_on</i>
                                <select id="estadoConclusao" data-ng-change="selecionaEstado()" data-ng-model="estadoId" data-ng-disabled="!escrita" required>
                                    <option value="{{ estado.id }}" data-ng-selected="verificaSelectEstado(estado.id)" data-ng-repeat="estado in estados">{{ estado.nome }}</option>
                                </select>
                                <label for="estadoConclusao" class="ajuste-select-top-label">Estado*</label>
                            </div>
                            <div ng-show="abreFormConclusao" class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">location_on</i>
                                <span class="digitable-icon"><i class="material-icons">border_color</i></span>
                                <input id="cidade" class="dropdown" type="text" data-ng-model="nomeCidade" data-ng-change="buscarCidades()" data-activates='dropCidadesConclusao'>
                                <label for="cidades">Cidades</label>
                            </div>
                            <ul id='dropCidadesConclusao' class='dropdown-content'>
                                <li class="divider"></li>
                                <li data-ng-repeat="cidade in cidadesConclusao">
                                    <a data-ng-click="carregarCidadeConclusao(cidade)">{{ cidade.nome | uppercase }} - {{cidade.estado.sigla}}</a>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="right-align" style="margin-bottom:0px; padding: 0;">
                            <a ng-show="isDisciplinaForm && !mostraDadosConclusao && !addObservacoes" class="waves-effect waves-blue btn-flat" ng-click="gerarDisciplinaCursada()">SALVAR</a>
                            <a ng-show="!isDisciplinaForm && mostraDadosConclusao && !addObservacoes" class="waves-effect waves-blue btn-flat right-align" ng-click="limparCamposConclusao()">CRIAR NOVO</a>
                            <a ng-show="!isDisciplinaForm && mostraDadosConclusao && !addObservacoes && abreFormConclusao" class="waves-effect waves-blue btn-flat" ng-click="gerarEtapaCursada()">SALVAR</a>
                        </div>
                        
                        <div ng-show="mostraDadosConclusao && conclusoes.length" class="card-content mobile-full">
                            <table class='highlight striped table-pattern'>
                                <thead>
                                    <tr>
                                        <th class="hide-on-small-only left-align" data-field='etapa'>Etapa</th>
                                        <th class='center-align hide-on-small-only center-align' data-field='unidade'>Opções</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-ng-repeat="conclusao in conclusoes track by $index">
                                        <td style="cursor: pointer;" ng-click="carregarEtapaCursada(conclusao)" class="hide-on-small-only center-align">{{ conclusao.etapa.nomeExibicao }}</td>
                                        <td class="center-align hide-on-small-only">
                                            <i style="cursor: pointer;" ng-click="modalRemoveConclusao(conclusao,$index)" class="material-icons">delete</i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>                        
                        
                        <span ng-show="isDisciplinaForm && !mostraDadosConclusao" class="card-title" style='color: #000;'>Disciplinas Cadastradas</span>
                        <div ng-hide="mostraDadosConclusao || addObservacoes" class="card-content mobile-full">

                            <!--<div class="input-field col s12 m12 l12">
                                <i class="material-icons prefix">search</i>
                                <span class="digitable-icon"><i class="material-icons">border_color</i></span>
                                <input id="listadasManuais" class="dropdown" type="text" ng-change="filtroDisciplinaLista()" data-ng-model="disciplinaNomeLista" data-ng-disabled="!escrita">
                                <label for="listadasManuais">Digite uma disciplina para editar/remover</label>
                            </div> -->

                            <table class='highlight striped table-pattern'>
                                <thead>
                                    <tr>
                                        <th class="hide-on-small-only left-align" data-field='disciplina'>Disciplina</th>
                                        <th class='center-align hide-on-small-only center-align' data-field='unidade'>Opções</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-ng-repeat="manual in manuais track by $index" ng-if="!manual.auto">
                                        <td class="hide-on-small-only center-align">{{ manual.nomeExibicao }} - {{ manual.etapa.nomeExibicao }}</td>
                                        <td class="center-align hide-on-small-only">
                                            <i style="cursor: pointer;" ng-click="addDisciplina(manual,manual.etapa,manual.cursadaId)" class="material-icons">edit</i>
                                            <i style="cursor: pointer;" ng-click="modalRemoveDisciplinaNova(manual,etapa)" class="material-icons">delete</i>
                                        </td>
                                    </tr>
                                    <tr data-ng-repeat="disciplina in disciplinasTabelaInterna track by $index" ng-if="!disciplina.ofertado">
                                        <td class="hide-on-small-only center-align">{{ disciplina.nomeExibicao }} - {{ disciplina.etapa.nomeExibicao }}</td>
                                        <td class="center-align hide-on-small-only">
                                            <i style="cursor: pointer;" ng-click="addDisciplina(disciplina,disciplina.etapa,disciplina.cursadaId)" class="material-icons">edit</i>
                                            <i style="cursor: pointer;" ng-click="modalRemoveDisciplinaNova(disciplina,etapa)" class="material-icons">delete</i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <span ng-show="addObservacoes" class="card-title" style='color: #000;'>Observações de Histórico</span>
                        <div ng-show="addObservacoes" class="card-content mobile-full">

                            <div class="col s12 m12 l12 input-field">
                                <i class="material-icons prefix">edit</i>
                                <textarea id="observacoes" class="materialize-textarea" data-ng-model="observacao.texto" data-ng-disabled="!escrita"></textarea>
                                <label for="observacoes">Observações</label>
                            </div>
                            <div class="right-align" style="margin-bottom:0px; padding: 0;">
                                <a class="waves-effect waves-blue btn-flat" ng-click="atualizarObservacoes()">SALVAR</a>
                            </div>

                            <table class='highlight striped table-pattern'>
                                <thead>
                                    <tr>
                                        <th class="hide-on-small-only left-align" data-field='disciplina'>Observação</th>
                                        <th class='center-align hide-on-small-only center-align' data-field='unidade'>Opções</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr data-ng-repeat="observacao in observacoes track by $index">
                                        <td class="hide-on-small-only center-align">{{ observacao.texto }}</td>
                                        <td class="center-align hide-on-small-only">
                                            <i style="cursor: pointer;" ng-click="editaObservacao(observacao)" class="material-icons">edit</i>
                                            <i style="cursor: pointer;" ng-click="modalRemoverObservacao(observacao)" class="material-icons">delete</i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                         
                    </div>
                </div>
                
                <div class="card" ng-hide="isAdicionandoDisciplina">
                    <div class="card-content white-text" style='color: #000 !important;'>
                        <span class="card-title" style='color: #000;'>Histórico - {{ matricula.aluno.nome }}</span>
                        <table>
                            <thead>
                                <tr>
                                    <th>DISCIPLINAS</th>
                                    <th ng-repeat="etapa in etapas track by $index">{{ etapa.nomeExibicao }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="disciplina in disciplinasTabela track by $index">
                                    <td><span>{{ disciplina.nomeExibicao }}</span></td>
                                    <td ng-repeat="etapa in etapas track by $index">
                                        <span ng-if="filtrarNota(disciplina,etapa) === '-'">{{ filtrarNota(disciplina,etapa) }}</span>
                                        <span ng-if="filtrarNota(disciplina,etapa) !== '-'">{{ filtrarNota(disciplina,etapa) }}</span>
                                        <span ng-if="filtrarNota(disciplina,etapa) !== '-' && !disciplina.ofertado"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="end-card right-align" style="margin-bottom:0px; padding: 0;">
                        <a class="waves-effect waves-blue btn-flat" ng-click="addDisciplina()">Gerenciar disciplinas</a>
                        <a class="waves-effect waves-blue btn-flat" ng-click="addDadosConclusao()">Dados de conclusão</a>
                        <a class="waves-effect waves-blue btn-flat" ng-click="addObservacoesForm()">Observações</a>
                        <a class="waves-effect waves-blue btn-flat" ng-click="getPDF(config.urlRelatorios+'/historico?matricula='+matricula.id)">IMPRIMIR</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        
<div id="modal-parciais" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-title-banner-info-aluno">
                    <h4 style="color:white;position:relative;top:250px;padding-left:10px;">Médias Parciais - {{ nomeDisc }}</h4>
                </div>
                <div class="row">
                    <table>
                        <thead>
                            <tr>
                                <th data-ng-repeat="md in totalTh track by $index" ng-class="oddTable($index)" style="text-align: center;">{{ md }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td data-ng-repeat="media in mediasConclusao track by $index" ng-class="oddTable($index)" style="text-align: center;">{{ media }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="remover-enturmacao-disciplina-nova" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-title-banner-matricula">
                    <h4 class="modal-alinha-texto" style="position: relative; top: 14rem; color: white;">Remover Disciplina</h4>
                </div>
                <p>Você realmente deseja remover a disciplina {{ nomeDisciplinaRemover }}?</p>
            </div>
            <div class="end-card" style="margin-bottom: 0px">
                <div class="modal-footer">
                    <a href="" class="modal-action modal-close waves-effect waves-red btn-flat">NÃO</a>
                    <a href="" data-ng-click="removerDisciplinaNova()" class="modal-action modal-close waves-effect waves-green btn-flat">REMOVER</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Exclusão -->
<div id="remover-observacao-nova" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-title-banner-matricula">
                    <h4 class="modal-alinha-texto" style="position: relative; top: 14rem; color: white;">Remover Observação</h4>
                </div>
                <p>Você realmente deseja remover esta observação?</p>
            </div>
            <div class="end-card" style="margin-bottom: 0px">
                <div class="modal-footer">
                    <a href="" class="modal-action modal-close waves-effect waves-red btn-flat ">NÃO</a>
                    <a href="" data-ng-click="removerObservacao()" class="modal-action modal-close waves-effect waves-green btn-flat ">SIM</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="remover-conclusao" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="modal-title-banner-matricula">
                    <h4 class="modal-alinha-texto" style="position: relative; top: 14rem; color: white;">Remover Dado de Conclusão</h4>
                </div>
                <p>Você realmente deseja remover este dado de conclusão?</p>
            </div>
            <div class="end-card" style="margin-bottom: 0px">
                <div class="modal-footer">
                    <a href="" class="modal-action modal-close waves-effect waves-red btn-flat ">NÃO</a>
                    <a href="" data-ng-click="removerConclusao()" class="modal-action modal-close waves-effect waves-green btn-flat ">SIM</a>
                </div>
            </div>
        </div>
    </div>
</div>